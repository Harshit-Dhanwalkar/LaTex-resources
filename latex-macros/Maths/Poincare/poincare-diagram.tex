% !TeX program = lualatex
% !TeX encoding = UTF-8
\documentclass[tikz,border=10pt]{standalone}
\usetikzlibrary{decorations.markings}

\usepackage{xcolor}
  \pagecolor{black}
  \color{white}

\tikzset
 {every pin/.style = {pin edge = {<-}},    % pins are arrows from label to point
  > = stealth,                             % arrow tips look like stealth bombers
  flow/.style =    % everything marked as "flow" will be decorated with an arrow
   {decoration = {markings, mark=at position #1 with {\arrow{>}}},
    postaction = {decorate}
   },
  flow/.default = 0.5,          % default position of the arrow is in the middle
  main/.style = {line width=1pt}                    % thick lines for main graph
 }

\newcommand\newtemplate[4][0.18]%
 {\newsavebox#2%
  \savebox#2%
   {\begin{tabular}{@{}c@{}}
      \begin{tikzpicture}[scale=#1]
      #4
      \end{tikzpicture}\\[-1ex]
      \templatecaption{#3}\\[-1ex]
    \end{tabular}%
   }%
 }
\newcommand\template[1]{\usebox{#1}}
\newcommand\templatecaption[1]{{\sffamily\scriptsize#1}}
\newcommand\Tr{\mathop{\mathrm{Tr}}}

\newtemplate\sink{Sink}%
 {\foreach \sx in {+,-}
   {\draw[flow] (\sx4,0) -- (0,0);
    \draw[flow] (0,\sx4) -- (0,0);
    \foreach \sy in {+,-}
      \foreach \a/\b in {2/1,3/0.44}
        \draw[flow,domain=\sx\a:0] plot (\x, {\sy\b*\x*\x});
   }
 }

\newtemplate\source{Source}%
 {\foreach \sx in {+,-}
   {\draw[flow] (0,0) -- (\sx4,0);
    \draw[flow] (0,0) -- (0,\sx4);
    \foreach \sy in {+,-}
      \foreach \a/\b in {2/1,3/0.44}
        \draw[flow,domain=0:\sx\a] plot (\x, {\sy\b*\x*\x});
   }
 }

\newtemplate\stablefp{Line of Stable Fixed Points}%
 {\draw (-4,0) -- (4,0);
  \foreach \sy in {+,-}
   {\draw[flow] (0,\sy4) -- (0,0);
    \foreach \x in {-3,-2,-1,1,2,3}
      \draw[flow] (\x,\sy3) -- (\x,0);
   }
 }

\newtemplate\unstablefp{Line of Unstable Fixed Points}%
 {\draw (-4,0) -- (4,0);
  \foreach \sy in {+,-}
   {\draw[flow] (0,0) -- (0,\sy4);
    \foreach \x in {-3,-2,-1,1,2,3}
      \draw[flow] (\x,0) -- (\x,\sy3);
   }
 }

\newtemplate\spiralsink{Spiral Sink}%
 {\draw (-4,0) -- (4,0);
  \draw (0,-4) -- (0,4);
  \draw [samples=100,smooth,domain=27:7]
        plot ({\x r}:{0.005*\x*\x});
  \def\x{26}
  \draw[->] ({\x r}:{0.005*\x*\x}) -- +(0.01,-0.01);
 }

\newtemplate\spiralsource{Spiral Source}%
 {\draw (-4,0) -- (4,0);
  \draw (0,-4) -- (0,4);
  \draw [samples=100,smooth,domain=10:28]
        plot ({-\x r}:{0.005*\x*\x});
  \def\x{27.5}
  \draw[<-] ({-\x r}:{0.005*\x*\x}) -- +(0.01,-0.008);
 }

\newtemplate[0.15]\centre{Center}%
 {\draw (-4,0) -- (4,0);
  \draw (0,-4) -- (0,4);
  \foreach \r in {1,2,3}
    \draw[flow=0.63] (\r,0) arc (0:-360:\r cm);
 }

\newtemplate\saddle{Saddle}%
 {\foreach \sx in {+,-}
   {\draw[flow] (\sx4,0) -- (0,0);
    \draw[flow] (0,0) -- (0,\sx4);
    \foreach \sy in {+,-}
      \foreach \a/\b/\c/\d in {2.8/0.3/0.7/0.6, 3.9/0.4/1.3/1.1}
        \draw[flow] (\sx\a,\sy\b)
          .. controls (\sx\c,\sy\d) and (\sx\d,\sy\c)
          .. (\sx\b,\sx\a);
   }
 }

\newtemplate\degensink{Degenerate Sink}%
 {\draw (0,-4) -- (0,4);
  \foreach \s in {+,-}
   {\draw[flow] (\s4,0) -- (0,0);
    \foreach \a/\b/\c/\d in {3.5/4/1.5/1, 2.5/2/1/0.8}
      \draw[flow] (\s-3.5,\s\a)
        .. controls (\s\b,\s\c) and (\s\b,\s\d)
        .. (0,0);
   }
 }

\newtemplate\degensource{Degenerate Source}%
 {\draw (0,-4) -- (0,4);
  \foreach \s in {+,-}
   {\draw[flow] (0,0) -- (\s4,0);
    \foreach \a/\b/\c/\d in {3.5/4/1.5/1, 2.5/2/1/0.8}
      \draw[flow] (0,0)
        .. controls (\s\b,\s\d) and (\s\b,\s\c)
        .. (\s-3.5,\s\a);
   }
 }

\begin{document}
\begin{tikzpicture}[line cap=round,line join=round]
	% MAIN DIAGRAM
	\draw [main,->] (0,-0.3) -- (0,4.7)
	node [label={[above]$\scriptstyle\det A$}] {}
	node [label={[above,yshift=0.8cm]%
					{\sffamily\large PoincarÃ© Diagram: Classification of Phase
						Portraits in the $(\det A,\Tr A)$-plane}}] {};
	\draw [main,->] (-5,0) -- (5,0)
	node [label={[right,yshift=-0.5ex]$\scriptstyle\Tr A$}] {};
	\draw [main, domain=-4:4] plot (\x, {0.25*\x*\x});
	\node at (-4,4) [pin={[above]$\scriptstyle\Delta=0$}] {};
	\node at ( 4,4) [pin={[above,align=left]%
					{$\scriptstyle\Delta=0:\;\det A=\frac{1}{4}(\Tr A)^2$}}] {};
	% TEMPLATES describing areas
	\node at ( 0  ,-1.4) {\template\saddle};
	\node at (-4  , 1  ) {\template\sink};
	\node at ( 4  , 1  ) {\template\source};
	\node at (-1.8, 3.7) {\template\spiralsink};
	\node at ( 1.8, 3.7) {\template\spiralsource};
	% TEMPLATES labeling lines and points
	\node at ( 0  , 1.2) [pin={[draw,right,xshift=0.3cm]%
				\template\centre}] {};
	\node at (-3  , 0  ) [pin={[draw,below,yshift=-1cm]%
				\template\stablefp}] {};
	\node at ( 3  , 0  ) [pin={[draw,below,yshift=-1cm]%
				\template\unstablefp}] {};
	\node at (-3.5,{0.25*3.5*3.5}) [pin={[draw,left,xshift=-1.15cm,yshift=-0.3cm]%
				\template\degensink}] {};
	\node at ( 3.5,{0.25*3.5*3.5}) [pin={[draw,right,xshift=0.9cm,yshift=-0.3cm]%
				\template\degensource}] {};
	\node at ( 0  , 0  ) [pin={[draw,above left,align=center,xshift=-0.3cm]%
				\templatecaption{Uniform}\\[-1ex]\templatecaption{Motion}}] {};
\end{tikzpicture}
\end{document}
